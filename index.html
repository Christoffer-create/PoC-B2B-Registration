<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Information Form</title>
</head>
<body>
    <h1>Azure Static Web App User Info</h1>

    <form id="userForm">
        <label for="userDetails">User Email:</label>
        <input type="text" id="userDetails" name="userDetails" readonly /><br><br>

        <label for="userId">User ID:</label>
        <input type="text" id="userId" name="userId" readonly /><br><br>

        <!-- Additional fields you want the user to fill out -->
        <input type="submit" value="Submit" />
    </form>

    <script>
        // Fetch user information from the .auth/me endpoint
        fetch('/.auth/me')
            .then(response => response.json())
            .then(data => {
                console.log(data);  // This will help us inspect the full response

                if (data.length > 0) {
                    // User is authenticated, extract user info from the data
                    const user = data[0].userClaims;
                    
                    // Extract email and user ID from claims
                    const emailClaim = user.find(claim => claim.typ === 'email');
                    const userIdClaim = user.find(claim => claim.typ === 'sub');
                    
                    document.getElementById('userDetails').value = emailClaim ? emailClaim.val : 'Email not available';
                    document.getElementById('userId').value = userIdClaim ? userIdClaim.val : 'User ID not available';
                } else {
                    alert('User is not authenticated.');
                }
            })
            .catch(error => console.error('Error fetching user info:', error));
    </script>
</body>
</html>
